# アップデート情報

## バージョン 1.1.0 - カスタム原価項目機能の追加

### 🎉 新機能

#### カスタム原価項目管理機能

原価計算に含める項目を自由に設定できるようになりました！

### 📋 主な追加機能

1. **カスタム原価項目の作成**
   - 包装費、減価償却費、家賃按分、配送費など、任意の原価項目を追加可能
   - 項目名、計算方法、金額を自由に設定

2. **3つの計算方法**
   - **固定費**: レシピ全体に対して一定額を加算
     - 例: 包装材料費 50円（レシピ全体で固定）
   - **個数あたり**: 製造個数 × 単価で計算
     - 例: 袋代 10円/個 × 10個 = 100円
   - **時間あたり**: 製造時間(分) × 分単価で計算
     - 例: 家賃按分 2円/分 × 180分 = 360円

3. **項目の有効/無効切り替え**
   - 一時的に原価計算から除外したい項目を無効化可能
   - 削除せずに保持できるため、再利用が簡単

4. **詳細な原価内訳表示**
   - レシピ詳細画面で、すべての原価項目の内訳を表示
   - カスタム項目の計算式も表示

### 🚀 使い方

#### 1. カスタム原価項目の追加

1. 「設定」メニューをクリック
2. 「カスタム原価項目管理」ボタンをクリック
3. 新しい原価項目を追加
   - 項目名を入力（例: 包装費）
   - 計算方法を選択
   - 金額を入力

#### 2. 項目の管理

- **有効/無効の切り替え**: チェックボタンをクリック
- **編集**: 「編集」ボタンから項目の内容を変更
- **削除**: ゴミ箱アイコンから削除

#### 3. 原価の確認

レシピ詳細ページで、カスタム項目を含めた原価が自動計算されます：

```
材料費: 500.00円
+ 人件費: 450.00円
+ 光熱費: 150.00円
+ 包装費 (10.00円 × 10個): 100.00円
+ 減価償却費: 50.00円
─────────────────
総原価: 1,250.00円
1個あたりの原価: 125円
```

### 💡 活用例

#### 例1: 包装費の追加

- **項目名**: 包装費
- **計算方法**: 個数あたり
- **金額**: 10円
- **説明**: 袋・シール代

→ 製造個数10個の場合、10円 × 10個 = 100円が原価に加算

#### 例2: 家賃按分

- **項目名**: 家賃按分
- **計算方法**: 時間あたり
- **金額**: 2円（月額家賃を時間按分した値）
- **説明**: 工房の家賃

→ 製造時間180分の場合、2円 × 180分 = 360円が原価に加算

#### 例3: 設備減価償却費

- **項目名**: オーブン減価償却費
- **計算方法**: 固定費
- **金額**: 100円
- **説明**: 月額減価償却を日数按分

→ どのレシピでも一律100円が原価に加算

#### 例4: 配送費

- **項目名**: 配送費
- **計算方法**: 個数あたり
- **金額**: 15円
- **説明**: 配送コスト

→ 製造個数分の配送費が原価に加算

### 📊 技術的な変更

#### 追加されたファイル

- `app/routes/custom_costs.py` - カスタム原価項目のルート
- `app/templates/custom_costs/index.html` - 管理画面テンプレート

#### 変更されたファイル

- `app/models.py` - CustomCostItemモデルの追加
- `app/__init__.py` - ルートの登録
- `app/routes/recipes.py` - レシピ詳細にカスタム項目を統合
- `app/templates/main/settings.html` - 設定画面にリンク追加
- `app/templates/recipes/detail.html` - 原価表示にカスタム項目を追加

#### データベース変更

新しいテーブル `custom_cost_items` が追加されます。
既存のデータベースは自動的にマイグレーションされます。

### 🔄 アップデート手順

1. アプリケーションを停止
2. 最新のコードを取得
3. アプリケーションを再起動
4. データベースが自動的に更新されます

```bash
# アプリを停止（Ctrl+C）

# 再起動
python run.py
```

または

```bash
simple_start.bat
```

### ⚠️ 注意事項

- カスタム原価項目は店舗ごとに独立して管理されます
- 無効化した項目は原価計算に含まれませんが、データは保持されます
- 項目を削除しても、既存のレシピの原価計算には影響しません（再計算されるため）

### 🆕 今後の機能拡張予定

- カスタム原価項目のテンプレート機能
- 項目のエクスポート/インポート
- 原価項目ごとの集計レポート
- 月次での原価推移グラフ

### 📞 サポート

問題が発生した場合は、以下を確認してください：

1. アプリケーションを再起動
2. ブラウザのキャッシュをクリア
3. データベースファイル（instance/bakery.db）が正常か確認

---

**カスタム原価項目機能をお楽しみください！**

より詳細な原価管理が可能になりました。
